import os, os.path
import subprocess
import sys

INCLUDE = ['src', 'lib/ESP-Arduino-Lua/src', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/libraries/SPIFFS/src', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/libraries/SD_MMC/src', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/libraries/SD/src', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/libraries/FS/src', '.pio/libdeps/Banane_V1_proto/AnimatedGIF/src', '.pio/libdeps/Banane_V1_proto/NimBLE-Arduino/src', '.pio/libdeps/Banane_V1_proto/ESP32 HUB75 LED MATRIX PANEL DMA Display/src', '.pio/libdeps/Banane_V1_proto/GFX_Root/src', '.pio/libdeps/Banane_V1_proto/FastLED/src', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/libraries/SPI/src', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/newlib/platform_include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/freertos/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/freertos/include/esp_additions/freertos', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/freertos/port/xtensa/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/freertos/include/esp_additions', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_hw_support/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_hw_support/include/soc', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_hw_support/include/soc/esp32', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_hw_support/port/esp32', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_hw_support/port/esp32/private_include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/heap/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/log/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/lwip/include/apps', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/lwip/include/apps/sntp', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/lwip/lwip/src/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/lwip/port/esp32/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/lwip/port/esp32/include/arch', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/soc/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/soc/esp32', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/soc/esp32/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/hal/esp32/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/hal/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/hal/platform_port/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_rom/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_rom/include/esp32', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_rom/esp32', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_common/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_system/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_system/port/soc', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_system/port/public_compat', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp32/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/xtensa/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/xtensa/esp32/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/driver/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/driver/esp32/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_pm/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_ringbuf/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/efuse/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/efuse/esp32/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/vfs/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_wifi/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_event/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_netif/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_eth/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/tcpip_adapter/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_phy/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_phy/esp32/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_ipc/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/app_trace/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_timer/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/mbedtls/port/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/mbedtls/mbedtls/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/mbedtls/esp_crt_bundle/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/app_update/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/spi_flash/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bootloader_support/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/nvs_flash/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/pthread/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_gdbstub/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_gdbstub/xtensa', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_gdbstub/esp32', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espcoredump/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espcoredump/include/port/xtensa', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/wpa_supplicant/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/wpa_supplicant/port/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/wpa_supplicant/esp_supplicant/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/ieee802154/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/console', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/asio/asio/asio/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/asio/port/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/common/osi/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/include/esp32/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/common/api/include/api', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/common/btc/profile/esp/blufi/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/common/btc/profile/esp/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/host/bluedroid/api/include/api', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/esp_ble_mesh/mesh_common/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/esp_ble_mesh/mesh_common/tinycrypt/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/esp_ble_mesh/mesh_core', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/esp_ble_mesh/mesh_core/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/esp_ble_mesh/mesh_core/storage', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/esp_ble_mesh/btc/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/esp_ble_mesh/mesh_models/common/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/esp_ble_mesh/mesh_models/client/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/esp_ble_mesh/mesh_models/server/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/esp_ble_mesh/api/core/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/esp_ble_mesh/api/models/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/bt/esp_ble_mesh/api', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/cbor/port/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/unity/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/unity/unity/src', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/cmock/CMock/src', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/coap/port/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/coap/libcoap/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/nghttp/port/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/nghttp/nghttp2/lib/includes', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp-tls', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp-tls/esp-tls-crypto', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_adc_cal/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_hid/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/tcp_transport/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_http_client/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_http_server/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_https_ota/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_https_server/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_lcd/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_lcd/interface', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/protobuf-c/protobuf-c', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/protocomm/include/common', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/protocomm/include/security', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/protocomm/include/transports', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/mdns/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_local_ctrl/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/sdmmc/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_serial_slave_link/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_websocket_client/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/expat/expat/expat/lib', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/expat/port/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/wear_levelling/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/fatfs/diskio', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/fatfs/vfs', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/fatfs/src', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/freemodbus/freemodbus/common/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/idf_test/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/idf_test/include/esp32', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/jsmn/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/json/cJSON', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/libsodium/libsodium/src/libsodium/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/libsodium/port_include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/mqtt/esp-mqtt/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/openssl/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/perfmon/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/spiffs/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/ulp/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/wifi_provisioning/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/rmaker_common/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_diagnostics/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/rtc_store/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_insights/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/json_parser/upstream/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/json_parser/upstream', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/json_generator/upstream', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_schedule/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp_secure_cert_mgr/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_rainmaker/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/gpio_button/button/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/qrcode/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/ws2812_led', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp_littlefs/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp-dl/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp-dl/include/tool', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp-dl/include/typedef', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp-dl/include/image', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp-dl/include/math', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp-dl/include/nn', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp-dl/include/layer', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp-dl/include/detect', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp-dl/include/model_zoo', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp-sr/src/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp-sr/esp-tts/esp_tts_chinese/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp-sr/include/esp32', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp32-camera/driver/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/esp32-camera/conversions/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/dotprod/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/support/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/windows/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/windows/hann/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/windows/blackman/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/windows/blackman_harris/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/windows/blackman_nuttall/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/windows/nuttall/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/windows/flat_top/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/iir/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/fir/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/math/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/math/add/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/math/sub/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/math/mul/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/math/addc/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/math/mulc/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/math/sqrt/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/matrix/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/fft/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/dct/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/conv/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/common/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/kalman/ekf/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/espressif__esp-dsp/modules/kalman/ekf_imu13states/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/include/fb_gfx/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/tools/sdk/esp32/dio_qspi/include', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/cores/esp32', '/Users/andrea/.platformio/packages/framework-arduinoespressif32/variants/esp32']

CC1PLUS = "/Users/andrea/.platformio/packages/toolchain-xtensa-esp32/libexec/gcc/xtensa-esp32-elf/8.4.0/cc1plus"

DEFINE = ['PLATFORMIO=60107', 'ARDUINO_ESP32_DEV', 'HOSTNAME="Spectre matrix V1"', 'USE_SPIFFS', 'LED_TOTAL=2048', 'LED_SIZE=3', 'USE_HUB75', 'USE_GFX_ROOT', 'PIXEL_COLOR_DEPTH_BITS=8', 'R1_PIN=25', 'G1_PIN=26', 'B1_PIN=27', 'R2_PIN=14', 'G2_PIN=12', 'B2_PIN=13', 'A_PIN=23', 'B_PIN=19', 'C_PIN=5', 'D_PIN=17', 'E_PIN=-1', 'CLK_PIN=16', 'LAT_PIN=4', 'OE_PIN=15', 'BRIGHTNESS=25', 'MATRIX_W=64', 'MATRIX_H=32', 'MATRIX_CHAIN=1', 'MATRIX_LATCH_BLANK=1', 'DMA_DOUBLE_BUFF=1', 'FASTLED_CRGB_SUPPORT=1', 'HAVE_CONFIG_H', 'MBEDTLS_CONFIG_FILE="mbedtls/esp_config.h"', 'UNITY_INCLUDE_CONFIG_H', 'WITH_POSIX', '_GNU_SOURCE', 'IDF_VER="v4.4.4"', 'ESP_PLATFORM', '_POSIX_READER_WRITER_LOCKS', 'ARDUINO_ARCH_ESP32', 'ESP32', 'F_CPU=240000000L', 'ARDUINO=10812', 'ARDUINO_VARIANT="esp32"', 'ARDUINO_BOARD="Espressif ESP-WROVER-KIT"', 'ARDUINO_PARTITION_noota_3g']

def build(fp):
  opath = fp + ".o"
  spath = fp + ".s"

  cmd = [CC1PLUS]
  for i in INCLUDE:
    cmd.append("-I")
    cmd.append(i)
  cmd.append("-quiet")
  cmd.append("-imultilib")
  cmd.append("no-rtti")
  # cmd.append("")
  cmd.append("-iprefix")
  cmd.append("/Users/andrea/.platformio/packages/toolchain-xtensa-esp32/lib/gcc/xtensa-esp32-elf/8.4.0/")
  # -MMD .pio/build/Banane_V1_proto/src/Gif.cpp.d -MQ .pio/build/Banane_V1_proto/src/Gif.cpp.o
  # cmd.append("-MMD")
  # cmd.append(fp + ".d")
  # cmd.append("-MQ")
  # cmd.append(opath)
  for d in DEFINE:
    cmd.append("-D")
    cmd.append(d)

  cmd.append(fp)

  cmd.append("-quiet")
  cmd.append("-dumpbase")
  cmd.append(os.path.basename(fp))
  cmd.append("-mlongcalls")
  cmd.append("-auxbase-strip")
  cmd.append(opath)
  # cmd.append("-ggdb")
  for x in "-O2 -Os -Wno-frame-address -Wno-error=unused-function -Wno-error=unused-variable -Wno-error=deprecated-declarations -Wno-unused-parameter -Wno-sign-compare -Wwrite-strings -Wno-error=unused-but-set-variable -std=gnu++11 -fexceptions -fno-rtti -ffunction-sections -fdata-sections -freorder-blocks -fstack-protector -fstrict-volatile-bitfields -fno-jump-tables -fno-tree-switch-conversion".split():
    cmd.append(x)
  # cmd.append("-Werror=unused")

  cmd.append("-o")
  cmd.append(spath)
  # -o /var/folders/8j/gbydwgd56g71x40zw98pfpbc0000gn/T//ccKij9fE.s

  # print(cmd)
  subprocess.run(cmd)

  subprocess.run([
    "/Users/andrea/.platformio/packages/toolchain-xtensa-esp32/bin/xtensa-esp32-elf-gcc",
    "-c", spath,
    "-o", opath,
  ])

  subprocess.run([
    "/Users/andrea/.platformio/packages/toolchain-xtensa-esp32/xtensa-esp32-elf/bin/strip",
    "--strip-unneeded",
    opath,
  ])

  print("/Users/andrea/.platformio/packages/toolchain-xtensa-esp32/xtensa-esp32-elf/bin/readelf -a " + opath)

if __name__ == "__main__":
  build(sys.argv[1])
